<template>
    <t-page>
        <div slot="top-fix" class="banner">

        </div>
        <div slot="container" class="mecontainer">
        <t-right-menu >
            <div slot="left" class="menu-left" ref="go">
                <p left-item>口味选择</p>
                <p left-item>烤肉类</p>
                <p left-item>蔬菜类</p>
                <p left-item>海鲜类</p>
                <p left-item>锡纸类</p>
                <p left-item>小炒类</p>
                <p left-item>酒水类</p>
            </div>
            <div  slot='right' class="menu-right">
                <div right-item  default-show>
                    <div class="food-item">
                        <img src="../assets/imgs/food1.jpg" alt="">
                        <div>
                            <span class="header">鸡脆骨112121</span>
                            <span class="tips">够脆、够香、嘎嘣脆</span>
                            <div><span class="sale">月销量：5435</span><span class="like">赞23</span></div>
                            <span class="price">￥23</span>
                        </div>
                    </div>
                    <div class="food-item">
                        <img src="../assets/imgs/food1.jpg" alt="">
                        <div>
                            <span class="header">烤韭菜</span>
                            <span class="tips">够脆、够香、嘎嘣脆</span>
                            <div><span class="sale">月销量：5435</span><span class="like">赞23</span></div>
                            <span class="price">￥23</span>
                        </div>
                    </div>
                    <div class="food-item">
                        <img src="../assets/imgs/food1.jpg" alt="">
                        <div>
                            <span class="header">羊肉串</span>
                            <span class="tips">够脆、够香、嘎嘣脆</span>
                            <div><span class="sale">月销量：5435</span><span class="like">赞23</span></div>
                            <span class="price">￥23</span>
                        </div>
                    </div>
                    <div class="food-item">
                        <img src="../assets/imgs/food1.jpg" alt="">
                        <div>
                            <span class="header">鸡全翅</span>
                            <span class="tips">够脆、够香、嘎嘣脆</span>
                            <div><span class="sale">月销量：5435</span><span class="like">赞23</span></div>
                            <span class="price">￥23</span>
                        </div>
                    </div>
                    <div class="food-item">
                        <img src="../assets/imgs/food1.jpg" alt="">
                        <div>
                            <span class="header">葱香豆皮</span>
                            <span class="tips">够脆、够香、嘎嘣脆</span>
                            <div><span class="sale">月销量：5435</span><span class="like">赞23</span></div>
                            <span class="price">￥23</span>
                        </div>
                    </div>
                    <div class="food-item">
                        <img src="../assets/imgs/food1.jpg" alt="">
                        <div>
                            <span class="header">谈烤肥牛</span>
                            <span class="tips">够脆、够香、嘎嘣脆</span>
                            <div><span class="sale">月销量：5435</span><span class="like">赞23</span></div>
                            <span class="price">￥23</span>
                        </div>
                    </div>
                    <div class="food-item">
                        <img src="../assets/imgs/food1.jpg" alt="">
                        <div>
                            <span class="header">葱香茄子</span>
                            <span class="tips">够脆、够香、嘎嘣脆</span>
                            <div><span class="sale">月销量：5435</span><span class="like">赞23</span></div>
                            <span class="price">￥23</span>
                        </div>
                    </div>
                    <div class="food-item">
                        <img src="../assets/imgs/food1.jpg" alt="">
                        <div>
                            <span class="header">台湾热狗</span>
                            <span class="tips">够脆、够香、嘎嘣脆</span>
                            <div><span class="sale">月销量：5435</span><span class="like">赞23</span></div>
                            <span class="price">￥23</span>
                        </div>
                    </div>
                </div>
                <div right-item >
                    <p >羊肉串</p>
                    <p >蜜汁牛排</p>
                    <p >滋补羊腰</p>
                    <p >香辣牛蹄</p>
                    <p >牛肉串</p>
                    <p >牛板筋</p>
                    <p >鸡脆骨</p>
                    <p >鸡全翅</p>
                    <p >鸡中翅</p>
                    <p >鸡腿</p>
                    <p >鸡爪</p>
                    <p >骨肉相连</p>
                    <p >香辣猪蹄</p>
                    <p >麻辣牛肚</p>
                    <p >羊肉串</p>
                    <p >蜜汁牛排</p>
                    <p >滋补羊腰</p>
                    <p >香辣牛蹄</p>
                    <p >牛肉串</p>
                    <p >牛板筋</p>
                    <p >鸡脆骨</p>
                    <p >鸡全翅</p>
                    <p >鸡中翅</p>
                    <p >鸡腿</p>
                    <p >鸡爪</p>
                    <p >骨肉相连</p>
                    <p >香辣猪蹄</p>
                    <p >麻辣牛肚</p>
                    <p >羊肉串</p>
                    <p >蜜汁牛排</p>
                    <p >滋补羊腰</p>
                    <p >香辣牛蹄</p>
                    <p >牛肉串</p>
                    <p >牛板筋</p>
                    <p >鸡脆骨</p>
                    <p >鸡全翅</p>
                    <p >鸡中翅</p>
                    <p >鸡腿</p>
                    <p >鸡爪</p>
                    <p >骨肉相连</p>
                    <p >香辣猪蹄</p>
                    <p >麻辣牛肚</p>
                </div>
                <div right-item>
                    <p >烤韭菜</p>
                    <p >金针菇</p>
                    <p >娃娃菜</p>
                    <p >土豆片</p>
                    <p >四季豆</p>
                    <p >烤香菇</p>
                    <p >青椒</p>
                    <p >烤面筋</p>
                    <p >葱香豆皮</p>
                    <p >香叶豆腐</p>
                    <p >葱香茄子</p>
                    <p >烤年糕</p>
                    <p >玉米</p>
                    <p >油炸花生米</p>
                    <p >烤大葱</p>
                    <p >白干豆腐</p>
                </div>
            </div>
        </t-right-menu>
        </div>
    </t-page>
</template>

<script>
    export default {
        data() {
            return {
                movestartStatY: 0,//movestart时候的touch点y的坐标
                movestartHeight:0,//movestart时候的banner的高
                movestartScrollTop:0//movestart时候的右侧食物列表scrollTop的值
            }
        },
        methods: {
            touchmove($event) {
                console.log($event,1)
            },
            bodyScroll(event){  
                event.preventDefault();  
            },
            //返回角度
            GetSlideAngle(dx, dy) {
              return Math.atan2(dy, dx) * 180 / Math.PI;
            },
            //根据起点和终点返回方向 1：向上，2：向下，3：向左，4：向右,0：未滑动
            GetSlideDirection(startX, startY, endX, endY) {
                var _this = this;
                var dy = startY - endY;
                var dx = endX - startX;
                var result = 0;
    
                //如果滑动距离太短
                // if(Math.abs(dx) < 2 && Math.abs(dy) < 2) {
                //     return result;
                // }
    
                var angle = _this.GetSlideAngle(dx, dy);
                if(angle >= -45 && angle < 45) {
                    result = 4;
                }else if (angle >= 45 && angle < 135) {
                    result = 1;
                }else if (angle >= -135 && angle < -45) {
                    result = 2;
                }
                else if ((angle >= 135 && angle <= 180) || (angle >= -180 && angle < -135)) {
                    result = 3;
                }
    
                return result;
            }

 
        },
        mounted(){
            let _this = this;
            let height = 200;
            let topFix = _this.$el.querySelector('.banner');
            let flag = true;

            // alert(window.screen.height+"height-"+window.screen.width+"width");

            let winH = window.screen.height;
            let winW = window.screen.width;

            let startX, startY;
             let preX,preY;
            this.$el.addEventListener('touchstart',function(ev){
                    preX = startX = ev.touches[0].pageX;
                    preY = startY = ev.touches[0].pageY; 
                    _this.movestartStatY = event.changedTouches[0].screenY;
                    _this.movestartHeight = topFix.clientHeight;
                    _this.movestartScrollTop = _this.$el.querySelector('.menu-right').scrollTop;
                    if(flag){
                        document.addEventListener('touchmove',_this.bodyScroll,{passive:false}); 
                    }
                    
            })
            
           
            this.$el.addEventListener('touchmove',function(ev){
                console.log()
                var endX, endY;
                endX = ev.changedTouches[0].pageX;
                endY = ev.changedTouches[0].pageY;
                // var direction = _this.GetSlideDirection(startX, startY, endX, endY);
                var direction = _this.GetSlideDirection(preX, preY, endX, endY);
                preY = endY;
                preX = endX;
                switch(direction) {
                    case 0:
                        // alert("没滑动");
                        break;
                    case 1:
                        // alert("向上");
                        console.log("向上");
                        // if(height>0){ //if-height>=200

                            height=_this.movestartHeight + ev.changedTouches[0].screenY - _this.movestartStatY;
                                if(height<=0){
                                    topFix.style.height=0;
                                    height = 0;
                                    flag = false;
                                    document.removeEventListener('touchmove',_this.bodyScroll,{passive:false});
                                }else if(height>=200){
                                    topFix.style.height=200+'px';
                                    height = 200;
                                }else{
                                    topFix.style.height=height+'px';
                                }

                        // }//if-height>=200End
                        break;
                    case 2:
                        // alert("向下");
                        console.log("向下");
                        // if(height<200&&_this.movestartScrollTop==0){ //if-height<=200
                        if(_this.movestartScrollTop==0){ //if-height<=200
                            document.addEventListener('touchmove',_this.bodyScroll,{passive:false}); 
                            height=_this.movestartHeight + ev.changedTouches[0].screenY - _this.movestartStatY;
                                if(height<=0){
                                    topFix.style.height=0;
                                    height = 0;
                                    flag = false;
                                    document.removeEventListener('touchmove',_this.bodyScroll,{passive:false});
                                }else if(height>=200){
                                    topFix.style.height=200+'px';
                                    height = 200;
                                }else{
                                    topFix.style.height=height+'px';
                                }

                        }//if-height>=200End
                        break;
                    case 3:
                        // alert("向左");
                        break;
                    case 4:
                        // alert("向右");
                        break;
                    default:           
                }
            })
            
             this.$el.addEventListener('touchend',function(event){
               
             });

        }
    }
</script>

<style lang='scss' scoped>
.mecontainer{
    height: 100%;
    overflow: hidden;
}
.banner{
    width: 200px;
    height: 200px;
    background-color: black;
}

// 左右菜单开始
.menu-left{
    width: 25%;
    max-height: 100vh;
    height: 100vh;
    overflow: scroll;
    background-color: #eee;
    [left-item]{
        padding: 5vw 0;
        background-color: #eee;
        margin: 0;
    }
    [left-item].t-active{
        background-color: #fff;
    }
}
.menu-right-scroll{
    overflow: scroll !important;
}
.menu-right{
    text-align: start;
    // height: 100%;
    width: 75%;
    max-height: 100vh;
    // overflow: hidden;
    
    overflow:scroll;

    color: #555;
    padding-left: 3vw;
    .food-item{
        display: flex;
        margin-bottom: 4vw;
        >img{
            display: block;
            width: 22.6vw;
            height: 22.6vw;
        }
        >div{
            padding-left: 3vw;
        }
        .header{
            color: #555;
            font-size: 5vw;
            font-weight: bold;
        }
        .tips{
            color: #aaa;
            display: block;
            font-size: 3.6vw;
        }
        .sale , .like{
            font-size: 3.6vw;
            color: #aaa;
        }
        .price{
            color: #ff4c41;
            font-weight: 700;
            font-size: 5vw;
        }
    }
    
}
// 左右菜单结束
</style>